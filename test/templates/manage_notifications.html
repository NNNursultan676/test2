{% extends "base.html" %}

{% block title %}{{ get_translation('manage_notifications', 'Управление уведомлениями') }} - {{ get_translation('app_title') }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>
                <i class="fas fa-bell me-2"></i>
                {{ get_translation('manage_notifications', 'Управление уведомлениями') }}
            </h2>
        </div>

        <!-- Create Notification Form -->
        <div class="card mb-4">
            <div class="card-header">
                <h5><i class="fas fa-plus me-2"></i>Создать уведомление</h5>
                <small class="text-muted">Уведомления будут отправляться 3 раза с интервалом 10 минут и исчезать через 5 минут</small>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('create_notification') }}">
                    <div class="row">
                        <div class="col-md-12 mb-3">
                            <label for="message" class="form-label">Сообщение <span class="text-danger">*</span></label>
                            <textarea class="form-control" id="message" name="message" rows="3" required
                                    placeholder="Введите текст уведомления..."></textarea>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Дни недели <span class="text-danger">*</span></label>
                            <div class="form-check-container">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="monday" name="days_of_week" value="monday">
                                    <label class="form-check-label" for="monday">Понедельник</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="tuesday" name="days_of_week" value="tuesday">
                                    <label class="form-check-label" for="tuesday">Вторник</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="wednesday" name="days_of_week" value="wednesday">
                                    <label class="form-check-label" for="wednesday">Среда</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="thursday" name="days_of_week" value="thursday">
                                    <label class="form-check-label" for="thursday">Четверг</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="friday" name="days_of_week" value="friday">
                                    <label class="form-check-label" for="friday">Пятница</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="saturday" name="days_of_week" value="saturday">
                                    <label class="form-check-label" for="saturday">Суббота</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="sunday" name="days_of_week" value="sunday">
                                    <label class="form-check-label" for="sunday">Воскресенье</label>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="notification_time" class="form-label">Время отправки <span class="text-danger">*</span></label>
                                <input type="time" class="form-control" id="notification_time" name="notification_time" required>
                            </div>

                            <div class="mb-3">
                                <label for="weeks_count" class="form-label">Количество недель</label>
                                <select class="form-select" id="weeks_count" name="weeks_count">
                                    <option value="1">1 неделя</option>
                                    <option value="2">2 недели</option>
                                    <option value="3">3 недели</option>
                                    <option value="4">4 недели</option>
                                </select>
                            </div>

                            <div class="alert alert-info">
                                <small>
                                    <i class="fas fa-info-circle me-1"></i>
                                    Уведомления отправляются автоматически:<br>
                                    • 3 повтора с интервалом 10 минут<br>
                                    • Каждое сообщение исчезает через 5 минут
                                </small>
                            </div>
                        </div>
                    </div>

                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-plus me-2"></i>Создать уведомление
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Notifications List -->
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-list me-2"></i>Список уведомлений</h5>
            </div>
            <div class="card-body">
                {% if notifications %}
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Сообщение</th>
                                <th>Дни недели</th>
                                <th>Время</th>
                                <th>Недели</th>
                                <th>Создатель</th>
                                <th>Создано</th>
                                <th>Статус</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for notification in notifications %}
                            <tr>
                                <td>{{ notification.id }}</td>
                                <td>
                                    <div class="notification-message">
                                        {{ notification.message[:50] }}{% if notification.message|length > 50 %}...{% endif %}
                                    </div>
                                </td>
                                <td>
                                    <small class="text-muted">
                                        {{ notification.days_of_week | join(', ') }}
                                    </small>
                                </td>
                                <td>{{ notification.notification_time }}</td>
                                <td>{{ notification.weeks_count }}</td>
                                <td>{{ notification.created_by or 'Неизвестно' }}</td>
                                <td>
                                    <small class="text-muted">
                                        {{ notification.created_at.split('T')[0] if notification.created_at else 'Неизвестно' }}
                                    </small>
                                </td>
                                <td>
                                    {% if notification.is_active %}
                                        <span class="badge bg-success">Активно</span>
                                    {% else %}
                                        <span class="badge bg-secondary">Неактивно</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-4">
                    <i class="fas fa-bell-slash fa-3x text-muted mb-3"></i>
                    <p class="text-muted">Уведомления не найдены</p>
                    <p class="small text-muted">Создайте первое уведомление, используя форму выше</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<style>
.form-check-container {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.5rem;
}

.notification-message {
    max-width: 200px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

@media (max-width: 768px) {
    .form-check-container {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}